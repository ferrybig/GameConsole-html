<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>

        <button onclick="startWorker()">Start Worker</button> 
        <button onclick="stopWorker()">Stop Worker</button>
        <br><br>
        <div id="result"></div>
        <script>
            var w;

            var workNeeded = 2;
            var workNow = 0;
            var processors = navigator.hardwareConcurrency + 1 || 4;

            function startWorker() {
                if (typeof (Worker) !== "undefined") {
                    if (typeof (w) == "undefined") {
                        w = [];
                        for (var i = 0; i < processors; i++)
                            w[i] = new Worker("js/webworker_proof_of_work.js");
                    }
                    workNow = 1;
                    document.getElementById("result").innerHTML = "";
                    var message = {
                        dificulty: 4,
                        seed: "start-hash"
                    };
                    for (var i = 0; i < processors; i++) {
                        (function (t) {
                            w[t].onmessage = function (event) {
                                document.getElementById("result").innerHTML += event.data + "<br>";
                                if (workNow++ < workNeeded)
                                    w[t].postMessage(message);

                                else
                                {
                                    stopWorker();
                                }
                            };
                            w[t].postMessage(message);
                        })(i);
                    }
                } else {
                    document.getElementById("result").innerHTML = "Sorry! No Web Worker support.";
                }
            }

            function stopWorker() {
                for (var i = 0; i < processors; i++) {
                    w[i].terminate();
                }
                w = undefined;
            }
        </script>
    </body>
</html>
